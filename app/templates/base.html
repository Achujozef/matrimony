{# templates/base.html #}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{% block title %}Kerala Vishwakarma{% endblock %}</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* Design tokens */
    :root{
      --brand: #0b5ed7;
      --brand-600: #084298;
      --muted: #6c757d;
      --bg-1: #f7fbff;
      --bg-2: #f0f5fb;
      --surface: #ffffff;
      --radius: 12px;
      --shadow-soft: 0 8px 28px rgba(3,10,34,0.06);
      --shadow-strong: 0 18px 40px rgba(3,10,34,0.12);
      --container-width: 1150px;
    }

    html,body { height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(800px 400px at 5% 10%, rgba(11,94,215,0.04), transparent 10%), linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:#222;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding-top:72px; /* space for fixed navbar */
      line-height:1.45;
    }

    /* Navbar */
    .site-nav {
      backdrop-filter: blur(6px);
      background: rgba(255,255,255,0.88);
      border-bottom: 1px solid rgba(11,94,215,0.04);
      box-shadow: 0 6px 18px rgba(10,20,50,0.04);
    }
    .site-brand{
      display:flex; gap:.6rem; align-items:center; text-decoration:none;
      color:var(--brand); font-weight:700; font-size:1.05rem;
    }
    .brand-mark {
      width:44px; height:44px; display:grid; place-items:center;
      border-radius:10px; color:#fff; background:linear-gradient(135deg,var(--brand),var(--brand-600));
      box-shadow: 0 8px 20px rgba(11,94,215,0.12); font-weight:700;
    }

    .container-max { max-width: var(--container-width); margin: 0 auto; padding: 1rem; }

    /* Cards and helpers */
    .card-rounded { background:var(--surface); border-radius:var(--radius); box-shadow: var(--shadow-soft); }
    .card-elev { box-shadow: var(--shadow-strong); }
    .small-muted { color:var(--muted); font-size:.92rem; }
    .btn-pill { border-radius:999px; }

    /* Toast container (shared) */
    #serverToasts { position: fixed; top: 1rem; right: 1rem; z-index: 1400; width: 360px; }
    @media (max-width:540px) { #serverToasts { width: calc(100% - 2rem); left:1rem; right:1rem; } }

    /* Misc */
    @media (max-width: 991px){
      .container-max{ padding-left:0.75rem; padding-right:0.75rem; }
      body { padding-top:64px; }
      .brand-mark { width:40px; height:40px; }
    }
  </style>

  {% block head %}{% endblock %}
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg site-nav fixed-top">
    <div class="container-max d-flex align-items-center">
      <a class="site-brand" href="{% url 'dashboard' %}">
        <div class="brand-mark">KV</div>
        <div>
          Kerala Vishwakarma
          <div class="small-muted" style="font-weight:600;font-size:.8rem">Community Matrimonial</div>
        </div>
      </a>

      <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse ms-3">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item me-2 d-none d-md-block">
            <form class="d-flex" method="get" action="{% url 'dashboard' %}">
              <input name="q" class="form-control form-control-sm" style="min-width:220px;border-radius:999px 0 0 999px" type="search" placeholder="Search name, education or job" value="{{ request.GET.q|default:'' }}">
              <button class="btn btn-sm btn-primary btn-pill" style="border-radius:0 999px 999px 0" type="submit">Search</button>
            </form>
          </li>

          {% if user.is_authenticated %}
            <li class="nav-item dropdown ms-2">
              <a class="nav-link dropdown-toggle" href="#" id="userMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                {{ user.get_full_name|default:user.username }}
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                <li><a class="dropdown-item" href="#">My Profile</a></li>
                <li><a class="dropdown-item" href="{% url 'dashboard' %}">Dashboard</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'logout' %}">Logout</a></li>
              </ul>
            </li>
          {% else %}
            <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
            <li class="nav-item ms-2 d-none d-md-block"><a class="btn btn-primary btn-sm btn-pill text-white" href="{% url 'register' %}">Register</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>

  <!-- Offcanvas mobile -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileMenuLabel">Menu</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <form class="mb-3 d-flex" method="get" action="{% url 'dashboard' %}">
        <input name="q" class="form-control form-control-sm" type="search" placeholder="Search..." value="{{ request.GET.q|default:'' }}">
        <button class="btn btn-primary btn-sm ms-2" type="submit">Go</button>
      </form>

      <ul class="list-unstyled">
        <li class="mb-2"><a class="d-block py-2 px-2 rounded" href="{% url 'dashboard' %}">Explore Profiles</a></li>
        {% if user.is_authenticated %}
          <li class="mb-2"><a class="d-block py-2 px-2 rounded" href="#">My Profile</a></li>
          <li class="mb-2"><a class="d-block py-2 px-2 rounded" href="{% url 'logout' %}">Logout</a></li>
        {% else %}
          <li class="mb-2"><a class="d-block py-2 px-2 rounded" href="{% url 'login' %}">Login</a></li>
          <li class="mb-2"><a class="d-block py-2 px-2 rounded btn btn-outline-primary" href="{% url 'register' %}">Register</a></li>
        {% endif %}
      </ul>

      <hr/>
      <div class="small-muted">
        Community-first matrimonial â€” verified by your shakha president. Privacy-first: photos & phone revealed only with consent.
      </div>
    </div>
  </div>

  <!-- MAIN container -->
  <main class="container-max my-4">
    {% block content %}{% endblock %}
  </main>

  <!-- Shared toast container used by server and pages -->
  <div id="serverToasts" aria-live="polite" aria-atomic="true"></div>

  {# Render server messages into #serverToasts (no inline ternary). #}
  {% if messages %}
    <script>
      document.addEventListener('DOMContentLoaded', function(){
        const holder = document.getElementById('serverToasts');
        {% for message in messages %}
          (function(){
            const div = document.createElement('div');
            {% if message.tags == 'error' or message.level_tag == 'error' %}
              div.className = 'toast align-items-center text-bg-danger border-0 mb-2';
            {% else %}
              div.className = 'toast align-items-center text-bg-success border-0 mb-2';
            {% endif %}
            div.setAttribute('role','alert');
            div.setAttribute('aria-live','assertive');
            div.setAttribute('aria-atomic','true');
            div.innerHTML = `<div class="d-flex"><div class="toast-body">{{ message|escapejs }}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`;
            holder.appendChild(div);
            try { new bootstrap.Toast(div, { delay: 4200 }).show(); } catch(e){ console.warn(e); }
          })();
        {% endfor %}
      });
    </script>
  {% endif %}

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  {% block scripts %}{% endblock %}
</body>
</html>
